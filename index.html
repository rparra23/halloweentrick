<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Halloween — from Rudy Parra</title>
  <meta name="theme-color" content="#0b0b12" />
  <meta name="description" content="A spooky Trick-or-Treat greeting from Rudy Parra." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Trick UI styles */
    .trick-ui { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color:#cbd5e1; background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.5)); padding:12px; border-radius:10px; }
    .terminal { background: rgba(0,0,0,0.75); padding:12px; margin:0 0 12px 0; border-radius:6px; min-height:96px; white-space:pre-wrap; font-size:13px; overflow:hidden; color:#39ff14; text-shadow:0 0 8px rgba(57,255,20,0.25); }
    .scan { margin-bottom:8px; }
    .scan-row { display:flex; gap:8px; align-items:center; font-size:14px; }
    .scan-label { color:#94a3b8; font-weight:700; width:70px; }
    .scan-file { flex:1; font-family:inherit; color:#39ff14; }
    .progress { width:100%; height:12px; background:rgba(255,255,255,0.06); border-radius:8px; overflow:hidden; margin-top:8px; }
    .progress-bar { height:100%; width:0%; background:linear-gradient(90deg,#7c3aed,#39ff14); transition:width 0.25s linear; }

    .error-flash { min-height:28px; margin-top:8px; color:#ffd166; font-weight:800; text-align:center; height:28px; opacity:0; transition:opacity 0.12s ease; }

    /* glitch overlay */
    .glitch { position:fixed; inset:0; pointer-events:none; mix-blend-mode:screen; z-index:120; opacity:0; transition:opacity 0.06s linear; }
    .glitch.active { opacity:1; }
    .glitch .slice { position:absolute; left:0; right:0; height:18%; background:transparent; mix-blend-mode:screen; filter:blur(3px); }
    .glitch .slice.s1 { top:6%; transform:translateX(-6px) skewX(-2deg); background:linear-gradient(90deg, rgba(255,0,50,0.06), transparent); }
    .glitch .slice.s2 { top:34%; transform:translateX(6px) skewX(2deg); background:linear-gradient(90deg, rgba(0,255,150,0.05), transparent); }
    .glitch .slice.s3 { top:60%; transform:translateX(-8px) skewX(-1deg); background:linear-gradient(90deg, rgba(120,0,255,0.04), transparent); }
    :root {
      --bg: #0b0b12;
      --fg: #e6e6ea;
      --accent: #ff6b00; /* pumpkin */
      --accent-2: #7c3aed; /* purple */
      --card: rgba(255,255,255,0.03);
      --glass: rgba(0,0,0,0.55);
      --ok: #22c55e;
      --warn: #f97316;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--fg);
      background: radial-gradient(1200px 600px at 70% -10%, #1b1327 0%, var(--bg) 60%),
                  radial-gradient(900px 400px at -10% 20%, #142016 0%, transparent 60%),
                  radial-gradient(600px 300px at 110% 80%, #1e1420 0%, transparent 60%),
                  var(--bg);
      overflow-x: hidden;
    }
    .wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card {
      width: 100%;
      max-width: 780px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.35);
      padding: 28px;
      position: relative;
      overflow: hidden;
    }
    .title {
      font-family: Creepster, Inter, system-ui, sans-serif;
      font-size: clamp(36px, 8vw, 68px);
      line-height: 1;
      margin: 12px 0 8px;
      text-align: center;
      color: var(--accent);
      font-weight: 400; /* ensure not bold */
      letter-spacing: 0.5px; /* slight tracking for thinner feel */
      text-shadow: 0 0 6px rgba(255,107,0,0.40), 0 0 14px rgba(255,107,0,0.35), 0 0 28px rgba(255,140,0,0.22), 0 0 48px rgba(255,140,0,0.12);
      animation: glowPulse 2.2s ease-in-out infinite alternate;
      -webkit-font-smoothing: antialiased; /* crisper rendering */
      text-rendering: optimizeLegibility;
    }
    .subtitle { text-align: center; opacity: 0.9; margin-bottom: 24px; font-size: clamp(18px, 3.5vw, 28px); }
    .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .btn {
      appearance: none; border: none; cursor: pointer; padding: 16px 18px;
      font-size: 18px; font-weight: 600; border-radius: 14px; color: #111;
      transition: transform 0.08s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }
    .btn:active { transform: translateY(1px) scale(0.99); }
    .btn.trick { background: linear-gradient(135deg, #f97316, #fb923c); box-shadow: 0 8px 24px rgba(249,115,22,0.35); }
    .btn.treat { background: linear-gradient(135deg, #a78bfa, #7c3aed); color: #fff; box-shadow: 0 8px 24px rgba(124,58,237,0.35); }

    .footer { text-align: center; font-size: 12px; opacity: 0.7; margin-top: 18px; }
    .footer a { color: #ffffff; text-decoration: underline; }

    /* Floating pumpkins / bats */
    .floaty { position: absolute; opacity: 0.12; filter: blur(0.3px); }
    .p1 { left: -20px; top: -10px; font-size: 80px; animation: drift 6s linear infinite; }
    .p2 { right: 10px; top: -16px; font-size: 64px; animation: drift 7s linear infinite reverse; }
    .p3 { left: 50%; bottom: -10px; transform: translateX(-50%); font-size: 96px; animation: drift 8s linear infinite; }
    @keyframes drift { 0% { transform: translateX(0) translateY(0) rotate(0); } 50% { transform: translateX(10px) translateY(-8px) rotate(3deg); } 100% { transform: translateX(0) translateY(0) rotate(0); } }

    :root { --slime: #39ff14; }
    @keyframes zoomFade {
      0% { transform: translateY(0) scale(0.6); opacity: 1; }
      60% { transform: translateY(0) scale(1.15); opacity: 1; }
      100% { transform: translateY(0) scale(1.4); opacity: 0; }
    }
    @keyframes glowPulse {
      from { text-shadow: 0 0 4px rgba(255,107,0,0.35), 0 0 10px rgba(255,107,0,0.28), 0 0 20px rgba(255,140,0,0.18), 0 0 32px rgba(255,140,0,0.10); }
      to   { text-shadow: 0 0 8px rgba(255,107,0,0.45), 0 0 18px rgba(255,107,0,0.40), 0 0 36px rgba(255,140,0,0.26), 0 0 60px rgba(255,140,0,0.16); }
    }
    .treats-header {
      font-family:'Creepster',sans-serif;
      color: var(--slime);
      text-align:center;
      font-size: clamp(36px,8vw,68px);
      margin-top:20px;
      text-shadow: 0 0 22px rgba(57,255,20,0.35), 0 0 42px rgba(57,255,20,0.25);
      z-index:10; position:relative;
      animation: zoomFade 1.8s ease-out forwards;
      pointer-events: none; /* let map interactions pass through if overlapping */
    }

    /* Modal */
    .modal {
      position: fixed; inset: 0; display: none; place-items: center; padding: 20px;
      backdrop-filter: blur(2px);
      background: radial-gradient(600px 300px at center, rgba(0,0,0,0.7), rgba(0,0,0,0.85));
      z-index: 60;
    }
    .modal.show { display: grid; }
    .modal-box { width: 100%; max-width: 640px; background: var(--glass); color: var(--fg);
      border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; padding: 22px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    .modal-title { font-weight: 700; font-size: 20px; margin: 0 0 8px; }
    .modal-msg { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 14px; opacity: 0.95; }
    .dots::after { content: ''; display: inline-block; width: 1ch; animation: dots 1.2s steps(4,end) infinite; }
    @keyframes dots { 0% { content: ''; } 25% { content: '.'; } 50% { content: '..'; } 75% { content: '...'; } 100% { content: ''; } }
    .ok { color: var(--ok); font-weight: 700; }
    .warn { color: var(--warn); font-weight: 700; }
    .close { margin-top: 14px; display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; background: rgba(255,255,255,0.06); color: var(--fg); cursor: pointer; }

    /* Map modal */
    .map-wrap { position: relative; width: 100%; height: 0; padding-bottom: 65%; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.18); background: #0e0e14; }
    .map-wrap iframe { position: absolute; inset: 0; width: 100%; height: 100%; border: 0; }

    .event-tab {
      position: fixed;
      top: 18px;
      right: 18px;
      background: rgba(255,255,255,0.12);
      color: #fff;
      font-weight: 600;
      text-decoration: none;
      padding: 10px 16px;
      border-radius: 8px;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.2);
      transition: background 0.2s ease, transform 0.15s ease;
      z-index: 200;
    }
    .event-tab:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.05);
    }

    @media (max-width: 420px) {
      .btn { font-size: 16px; padding: 14px 16px; }
      .subtitle { font-size: 16px; }
    }

    /* Rickroll responsive embed */
    .rick { margin-top:14px; }
    .rick-embed { position: relative; width:100%; padding-top:56.25%; border-radius:10px; overflow:hidden; box-shadow: 0 6px 22px rgba(0,0,0,0.35); }
    .rick-embed iframe, .rick-embed video { position:absolute; inset:0; width:100%; height:100%; border:0; }

    /* Universal overlay for extra trick variants */
    .fx-overlay { position: fixed; inset: 0; z-index: 140; display:grid; place-items:center; background: rgba(0,0,0,0.75); color:#fff; text-align:center; padding:20px; }
    .fx-card { background: rgba(20,20,28,0.9); border:1px solid rgba(255,255,255,0.12); border-radius:14px; padding:18px; max-width: 680px; width: min(92vw, 680px); box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
    .fx-title { font-family:'Creepster', cursive; font-size: clamp(22px,5.6vw,36px); margin:0 0 8px; color:#ff6b00; }
    .fx-text { font: 600 14px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; opacity:0.95; }
    .fx-progress { height: 12px; background: rgba(255,255,255,0.08); border-radius: 10px; overflow:hidden; margin-top:12px; }
    .fx-bar { height:100%; width:0; background: linear-gradient(90deg,#7c3aed,#39ff14); transition: width 0.25s linear; }

    /* Static noise effect */
    .static:before { content:''; position:fixed; inset:0; z-index:150; pointer-events:none; background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="90" viewBox="0 0 160 90"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.25"/></svg>'); animation: noise .15s steps(2,end) infinite; }
    @keyframes noise { to { transform: translate3d(1px,0,0); } }

    /* Shake / flip / invert flashes */
    .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake { 10%, 90% { transform: translateX(-4px); } 20%, 80% { transform: translateX(4px);} 30%, 50%, 70% { transform: translateX(-8px);} 40%, 60% { transform: translateX(8px);} }
    .flip { transform: rotate(180deg); transition: transform 0.6s ease; }
    .invert { filter: invert(1) hue-rotate(180deg); transition: filter 0.2s ease; }

    /* Ghost pass animation */
    .ghost { position:fixed; top: 30%; left:-120px; font-size: clamp(48px,12vw,96px); z-index:145; filter: drop-shadow(0 8px 30px rgba(255,255,255,0.25)); animation: ghost-move 2.6s ease forwards; }
    @keyframes ghost-move { from { transform: translateX(0); opacity:0.2;} 20% {opacity:1;} to { transform: translateX(120vw); opacity:0.2;} }

    /* Split glitch */
    .split-wrap { position: fixed; inset: 0; z-index: 145; pointer-events:none; }
    .split-left, .split-right { position:absolute; inset:0; background: inherit; filter: contrast(120%); mix-blend-mode: screen; }
    .split-left { transform: translateX(-4px); clip-path: inset(0 50% 0 0); }
    .split-right { transform: translateX(4px); clip-path: inset(0 0 0 50%); }

    /* QR box */
    .qr-box { background:#fff; color:#111; padding:16px; border-radius:12px; width:min(90vw,360px); }
    .qr-title { font-weight:800; margin:0 0 6px; }
    .qr-img { width:100%; height:auto; display:block; }

    /* Confetti (emoji) */
    .confetti { position: fixed; inset: 0; pointer-events:none; z-index: 150; overflow:hidden; }
    .confetti span { position:absolute; font-size: clamp(16px,5vw,28px); animation: fall 1.4s linear forwards; }
    @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0.2; } }
  </style>
</head>
<body>
  <a href="https://www.nmtechtalks.com/events" target="_blank" rel="noopener" class="event-tab">Local Tech Events in ABQ</a>
  <div class="wrap">
    <div class="card">
      <div class="floaty p1">🎃</div>
      <div class="floaty p2">🦇</div>
      <div class="floaty p3">👻</div>

      <h1 class="title">BOOQUERÑO<br/>HALLOWEEN&nbsp;MAP<br/>2025</h1>
      <p class="subtitle" style="color:#39ff14; font-family:'Creepster', cursive;">Pick your fate.</p>

      <div class="btns">
        <button class="btn trick" id="trickBtn" aria-label="Trick">🎭 Trick</button>
        <button class="btn treat" id="treatBtn" aria-label="Treat">🍬 Treat</button>
      </div>

      <p class="body-text" style="text-align:center; max-width:600px; margin:18px auto; line-height:1.5; font-size:clamp(16px,2.6vw,20px); color:#f3f3f3; opacity:0.9;">
        Welcome to the <strong>BOOQUERÑO HALLOWEEN MAP 2025</strong> — a cute Halloween trick website with a <em>treat</em> packed inside!
        Discover a curated map of Albuquerque’s most festive Halloween stops — from spooky house displays and haunted attractions to cozy trick‑or‑treat hotspots.
        <br><br>
        The map, titled <a href="https://www.google.com/maps/d/u/0/viewer?fbclid=IwAR0IGf1tvOp2R_9wjCR_Q-tas5WfDaDXKK1yNgtFvn3SAnbsuobrCOg0Jlc&mid=1SSQ78PUjHgqx0MVho1ZQ1MTlwqDm17r-&ll=35.13756615894715%2C-106.68808458159079&z=14" target="_blank" rel="noopener" style="color:#39ff14; text-decoration:underline;">Albuquerque Area Halloween Display Tour</a>, was lovingly curated by <strong>Melissa Rex</strong>.
        <br><br>
        Don’t worry — the <em>Trick</em> isn’t scary. Halloween is fun for everyone!
      </p>

      <p class="footer">No data is collected. This is a harmless prank.</p>
      <p class="footer">Made by <a href="https://rparra23.github.io/Personal-Website/" target="_blank" rel="noopener">Rudy Parra</a>.</p>
    </div>
  </div>

  <!-- Trick modal -->
  <div class="modal" id="trickModal" role="dialog" aria-modal="true" aria-labelledby="trickTitle">
    <div class="modal-box">
      <h2 class="modal-title" id="trickTitle">System Notice</h2>

      <!-- Trick UI: terminal + progress + error flash -->
      <div class="trick-ui" id="trickUI">
        <pre class="terminal" id="fakeTerminal" aria-live="polite">Initializing...</pre>

        <div class="scan">
          <div class="scan-row">
            <div class="scan-label">Scanning:</div>
            <div class="scan-file" id="scanFile">preparing...</div>
          </div>
          <div class="progress" aria-hidden="true">
            <div class="progress-bar" id="progressBar" style="width:0%"></div>
          </div>
        </div>

        <div class="error-flash" id="errorFlash" aria-hidden="true"></div>
        <div class="rick" id="rick" style="display:none">
          <div class="rick-embed">
            <video id="rickVideo" src="v0f025gc0000cgmed4rc77ubta66o2p0.MP4" playsinline preload="auto" controls style="display:none"></video>
          </div>
        </div>
      </div>

      <button class="close" id="trickClose" style="display:none">Close</button>
    </div>
  </div>

  <!-- Glitch overlay element (page-level) -->
  <div class="glitch" id="glitchOverlay" aria-hidden="true">
    <div class="slice s1"></div>
    <div class="slice s2"></div>
    <div class="slice s3"></div>
  </div>

  <!-- Treat modal with fullscreen embedded map -->
  <div class="modal" id="treatModal" role="dialog" aria-modal="true" aria-labelledby="treatTitle" style="padding:0; background:#000;">
    <h1 class="treats-header">TREATS NEAR YOU</h1>
    <iframe
      src="https://www.google.com/maps/d/embed?mid=1SSQ78PUjHgqx0MVho1ZQ1MTlwqDm17r-&ehbc=2E312F"
      allowfullscreen
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade"
      style="position:absolute; top:0; left:0; width:100%; height:100%; border:0;"
    ></iframe>
    <button
      class="close"
      id="treatClose"
      style="position:absolute; top:20px; right:20px; z-index:10; background:rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.3); color:#fff;"
    >Close</button>
  </div>

  <script>
    const trickBtn = document.getElementById('trickBtn');
    const treatBtn = document.getElementById('treatBtn');
    const trickModal = document.getElementById('trickModal');
    const treatModal = document.getElementById('treatModal');
    const trickClose = document.getElementById('trickClose');

    // Accessibility helpers
    function trapFocus(modal) {
      const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if(!focusable.length) return;
      const first = focusable[0];
      const last = focusable[focusable.length - 1];
      function handle(e){
        if(e.key !== 'Tab') return;
        if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
        else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
      }
      modal.addEventListener('keydown', handle);
      first.focus();
    }


    // --- Trick sequence: terminal + fake scan + glitch + errors ---
    const trickBtnEl = document.getElementById('trickBtn');
    const trickModalEl = document.getElementById('trickModal');
    const trickCloseEl = document.getElementById('trickClose');
    const fakeTerminal = document.getElementById('fakeTerminal');
    const scanFileEl = document.getElementById('scanFile');
    const progressBar = document.getElementById('progressBar');
    const errorFlash = document.getElementById('errorFlash');
    const glitchOverlay = document.getElementById('glitchOverlay');

    function typeLines(el, lines, speed = 28, cb) {
      let i = 0;
      function nextLine() {
        if (i >= lines.length) { if (cb) cb(); return; }
        const line = lines[i++];
        let j = 0;
        el.textContent += '\n';
        function typeChar() {
          if (j >= line.length) { setTimeout(nextLine, 220); return; }
          el.textContent += line[j++];
          el.scrollTop = el.scrollHeight;
          setTimeout(typeChar, speed + Math.random()*20);
        }
        typeChar();
      }
      el.textContent = ''; nextLine();
    }

    function randomFilename() {
      const names = [
        'passwords.txt','tax_return.pdf','holiday_photos.zip','bank_backup.enc',
        'secrets.db','spotify_tokens.txt','secret_recipes.docx','notes_private.txt',
        'credentials.csv','wallet_backup.key'
      ];
      return names[Math.floor(Math.random()*names.length)];
    }

    function flashError(msg, t=900) {
      errorFlash.textContent = msg;
      errorFlash.style.opacity = '1';
      setTimeout(()=> { errorFlash.style.opacity = '0'; }, t);
    }

    function primeVideo() {
      const rv = document.getElementById('rickVideo');
      if (rv) {
        try {
          rv.preload = 'auto';
          rv.muted = true;
          rv.volume = 0;
          rv.load();
          rv.play().catch(() => {});
        } catch (e) { /* no-op */ }
      }
    }
    function endWithRick(message = "JUST KIDDING — YOU'VE BEEN TRICKED 🎃") {
      fakeTerminal.textContent += '\n\n' + message;
      scanFileEl.textContent = 'complete';
      progressBar.style.width = '100%';
      trickCloseEl.style.display = 'inline-flex';
      trickCloseEl.focus();
      const rick = document.getElementById('rick');
      if (rick) {
        rick.style.display = 'block';
        const rv = document.getElementById('rickVideo');
        if (rv) {
          try {
            rv.style.display = 'block';
            rv.currentTime = 0;
            rv.muted = false;
            rv.volume = 1.0;
            const p = rv.play();
            if (p !== undefined) {
              p.then(() => {
                if (rv.requestFullscreen) rv.requestFullscreen().catch(() => {});
                else if (rv.webkitRequestFullscreen) rv.webkitRequestFullscreen();
                else if (rv.msRequestFullscreen) rv.msRequestFullscreen();
              }).catch(() => {});
            }
          } catch (e) { /* no-op */ }
        }
      }
    }

function runVirusTrick() {
      trickModalEl.classList.add('show');
      trapFocus(trickModalEl);
      primeVideo();

      const terminalLines = [
        'Connecting to spookyserver.net...',
        'Establishing secure tunnel...',
        'Bypassing firewall (please wait)...',
        'Enumerating user files...'
      ];

      typeLines(fakeTerminal, terminalLines, 28, () => {
        let progress = 0;
        const total = 14;
        let scanned = 0;
        const scanInterval = setInterval(() => {
          scanned++;
          const fname = randomFilename();
          scanFileEl.textContent = fname;
          progress = Math.min(100, Math.round((scanned/total)*100));
          progressBar.style.width = progress + '%';

          if (Math.random() < 0.28) {
            const errors = [
              'Error 404 — Pumpkin Not Found',
              'System failure: ghost detected 👻',
              'Warning: candy overflow',
              'ERR_CONNECTION_SPOOKY',
              'Disk read anomaly: cobwebs present'
            ];
            flashError(errors[Math.floor(Math.random()*errors.length)], 700);
          }

          if (progress === 40 || progress === 75) {
            glitchOverlay.classList.add('active');
            setTimeout(()=> glitchOverlay.classList.remove('active'), 700 + Math.random()*600);
          }

          fakeTerminal.textContent += '\n[scan] ' + fname + ' ... OK';
          fakeTerminal.scrollTop = fakeTerminal.scrollHeight;

          if (scanned >= total) {
            clearInterval(scanInterval);
            setTimeout(() => {
              flashError('CRITICAL: spooky payload executed', 1300);
              glitchOverlay.classList.add('active');
              setTimeout(()=> glitchOverlay.classList.remove('active'), 900);
              setTimeout(() => {
                endWithRick();
              }, 900);
            }, 550);
          }
        }, 300);
      });
    }

// --- Trick variants (visible differences) ---
function runGhostTrick() {
  trickModalEl.classList.add('show');
  trapFocus(trickModalEl);
  primeVideo();

  const terminalLines = [
    'Contacting ecto-relay...',
    'Summoning friendly ghosts...',
    'Negotiating spectral bandwidth...',
    'Queuing uploads...'
  ];
  typeLines(fakeTerminal, terminalLines, 24, () => {
    let progress = 0; const total = 10; let sent = 0;
    const files = ['door_creak.wav','boo_whisper.aac','candy_manifest.csv','map_sightings.kml','pumpkin_glow.png','bat_paths.geojson'];
    const t = setInterval(() => {
      sent++;
      const fname = files[Math.floor(Math.random()*files.length)];
      scanFileEl.textContent = fname;
      progress = Math.min(100, Math.round((sent/total)*100));
      progressBar.style.width = progress + '%';
      if (Math.random() < 0.3) {
        const errors = ['Upload delay: ectoplasm detected','Retrying… spirit busy','Warning: lantern flicker'];
        flashError(errors[Math.floor(Math.random()*errors.length)], 700);
      }
      if (progress === 30 || progress === 60) {
        glitchOverlay.classList.add('active');
        setTimeout(()=> glitchOverlay.classList.remove('active'), 500 + Math.random()*500);
      }
      fakeTerminal.textContent += '\n[upload] ' + fname + ' ... DONE';
      fakeTerminal.scrollTop = fakeTerminal.scrollHeight;
      if (sent >= total) { clearInterval(t); setTimeout(() => endWithRick('JUST KIDDING — GHOSTS APPROVE 🎃'), 700); }
    }, 260);
  });
}

function runAITrick() {
  trickModalEl.classList.add('show');
  trapFocus(trickModalEl);
  primeVideo();

  const terminalLines = [
    'Initializing candy-model v2...',
    'Loading weights… 13M params',
    'Sampling spooky text…',
    'Optimizing treat routes...'
  ];
  typeLines(fakeTerminal, terminalLines, 18, () => {
    let i = 0; const total = 16;
    const phrases = ['hallucination reduced','pumpkin token saved','ghost prompt parsed','candy cache warmed','latency: 13ms'];
    const t = setInterval(() => {
      i++;
      progressBar.style.width = Math.min(100, Math.round((i/total)*100)) + '%';
      if (Math.random() < 0.35) {
        const errs = ['Model drift detected','Overfitting on candy','GPU haunted; falling back','Cache miss: cobweb'];
        flashError(errs[Math.floor(Math.random()*errs.length)], 650);
      }
      if (i === 5 || i === 12) {
        glitchOverlay.classList.add('active');
        setTimeout(()=> glitchOverlay.classList.remove('active'), 600);
      }
      const phrase = phrases[Math.floor(Math.random()*phrases.length)];
      fakeTerminal.textContent += '\n[ai] ' + phrase;
      fakeTerminal.scrollTop = fakeTerminal.scrollHeight;
      if (i >= total) { clearInterval(t); setTimeout(() => endWithRick(), 600); }
    }, 220);
  });
}


    // --- Trick variants framework ---
    function runPumpkinTrick() {
      // TODO: implement alternate "Pumpkin.exe update" variant
      return runVirusTrick();
    }

    const TRICK_VARIANTS = [
      runVirusTrick,
      runGhostTrick,
      runAITrick,
      runPumpkinTrick,
      runStaticTrick,
      runCursorJailbreakTrick,
      runButtonDodgeTrick,
      runOsUpdateTrick,
      runScreenFlipTrick,
      runInvertFlashTrick,
      runWindowShakeTrick,
      runGhostPassTrick,
      runFakeQRTrick,
      runConfettiTrick,
      runBatterySpoofTrick,
      runSplitGlitchTrick,
      runCountdownTrick
    ];
    // Helpers for variants
    const isTouch = () => matchMedia('(pointer: coarse)').matches;
    function makeOverlay(innerHTML) {
      const o = document.createElement('div');
      o.className = 'fx-overlay';
      o.innerHTML = innerHTML;
      document.body.appendChild(o);
      return o;
    }
    function removeOverlay(el) { if (el && el.parentNode) el.parentNode.removeChild(el); }

    // Variant 1: Screen static
    function runStaticTrick() {
      trickModalEl.classList.add('show');
      trapFocus(trickModalEl); primeVideo();
      document.documentElement.classList.add('static');
      setTimeout(()=>{ document.documentElement.classList.remove('static'); endWithRick(); }, 1600);
    }

    // Variant 2: Cursor jailbreak (mobile => shake)
    function runCursorJailbreakTrick() {
      trickModalEl.classList.add('show');
      trapFocus(trickModalEl); primeVideo();
      if (isTouch()) {
        document.body.classList.add('shake');
        setTimeout(()=>{ document.body.classList.remove('shake'); endWithRick(); }, 900);
        return;
      }
      let handler = (e)=>{ document.body.style.transform = `translate(${(Math.random()*80-40)|0}px, ${(Math.random()*20-10)|0}px)`; };
      window.addEventListener('mousemove', handler);
      setTimeout(()=>{ window.removeEventListener('mousemove', handler); document.body.style.transform=''; endWithRick(); }, 1200);
    }

    // Variant 3: Button dodge (hover/touch 3 times)
    function runButtonDodgeTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const btn = trickCloseEl; btn.style.display='inline-flex';
      let moves = 0; const maxMoves = 3;
      function hop() {
        if (moves >= maxMoves) { btn.removeEventListener('mouseenter', hop); btn.removeEventListener('touchstart', hop); btn.style.transform=''; endWithRick(); return; }
        moves++;
        const x = Math.round((Math.random()*60)-30); const y = Math.round((Math.random()*40)-20);
        btn.style.transform = `translate(${x}px, ${y}px)`;
      }
      btn.addEventListener('mouseenter', hop, {passive:true});
      btn.addEventListener('touchstart', hop, {passive:true});
    }

    // Variant 4: Fake OS update
    function runOsUpdateTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const box = makeOverlay(`<div class="fx-card"><div class="fx-title">PumpkinOS Update</div><div class="fx-text">Installing seasonal features… Please do not close.</div><div class="fx-progress"><div class="fx-bar" id="fxBar"></div></div></div>`);
      const bar = box.querySelector('#fxBar'); let p=0; const t=setInterval(()=>{ p=Math.min(100,p+Math.ceil(Math.random()*18)); bar.style.width=p+'%'; if(p>=100){ clearInterval(t); setTimeout(()=>{ removeOverlay(box); endWithRick('JUST KIDDING — UPDATE COMPLETE 🎃'); }, 300);} }, 260);
    }

    // Variant 5: Screen flip
    function runScreenFlipTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      document.documentElement.classList.add('flip');
      setTimeout(()=>{ document.documentElement.classList.remove('flip'); endWithRick(); }, 1200);
    }

    // Variant 6: Invert flash
    function runInvertFlashTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      document.documentElement.classList.add('invert');
      setTimeout(()=>{ document.documentElement.classList.remove('invert'); endWithRick(); }, 900);
    }

    // Variant 7: Window shake
    function runWindowShakeTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      document.body.classList.add('shake');
      setTimeout(()=>{ document.body.classList.remove('shake'); endWithRick(); }, 600);
    }

    // Variant 8: Ghost pass‑through
    function runGhostPassTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const g = document.createElement('div'); g.className='ghost'; g.textContent='👻'; document.body.appendChild(g);
      setTimeout(()=>{ g.remove(); endWithRick(); }, 2600);
    }

    // Variant 9: Fake QR prompt
    function runFakeQRTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const url = location.href;
      const box = makeOverlay(`<div class="fx-card"><div class="fx-title">Verify to claim candy</div><div class="fx-text">Scan this QR to continue.</div><div class="qr-box"><img class="qr-img" alt="QR" src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(url)}"></div></div>`);
      setTimeout(()=>{ removeOverlay(box); endWithRick(); }, 1800);
    }

    // Variant 10: Confetti burst (emoji)
    function runConfettiTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const c = document.createElement('div'); c.className='confetti'; document.body.appendChild(c);
      const em = ['🎃','🍬','👻','🦇','🕸️'];
      for(let i=0;i<40;i++){ const s=document.createElement('span'); s.textContent=em[Math.floor(Math.random()*em.length)]; s.style.left=Math.random()*100+'vw'; s.style.top='-20px'; c.appendChild(s); }
      setTimeout(()=>{ c.remove(); endWithRick(); }, 1200);
    }

    // Variant 11: Battery spoof
    function runBatterySpoofTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const box = makeOverlay(`<div class="fx-card"><div class="fx-title">Battery Low</div><div class="fx-text">5% remaining. Enabling power‑saving…</div></div>`);
      setTimeout(()=>{ removeOverlay(box); endWithRick(); }, 1400);
    }

    // Variant 12: Split glitch
    function runSplitGlitchTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const w = document.createElement('div'); w.className='split-wrap';
      const l = document.createElement('div'); l.className='split-left';
      const r = document.createElement('div'); r.className='split-right';
      w.appendChild(l); w.appendChild(r); document.body.appendChild(w);
      setTimeout(()=>{ w.remove(); endWithRick(); }, 900);
    }

    // Variant 13: Countdown fakeout
    function runCountdownTrick() {
      trickModalEl.classList.add('show'); trapFocus(trickModalEl); primeVideo();
      const box = makeOverlay(`<div class="fx-card"><div class="fx-title">Stand by…</div><div class="fx-text" id="cd">Self‑destruct in 3</div></div>`);
      const cd = box.querySelector('#cd'); let n=3; const t=setInterval(()=>{ n--; cd.textContent = 'Self‑destruct in ' + n; if(n<=0){ clearInterval(t); removeOverlay(box); endWithRick(); } }, 500);
    }

    function runRandomTrick() {
      const pick = TRICK_VARIANTS[Math.floor(Math.random() * TRICK_VARIANTS.length)];
      pick();
    }

    trickBtnEl.addEventListener('click', runRandomTrick);

    trickCloseEl.addEventListener('click', () => {
      trickModalEl.classList.remove('show');
      document.querySelectorAll('.fx-overlay,.split-wrap,.confetti,.ghost').forEach(n=>n.remove());
      // reset UI for next run
      fakeTerminal.textContent = 'Initializing...';
      scanFileEl.textContent = 'preparing...';
      progressBar.style.width = '0%';
      errorFlash.style.opacity = '0';
    });

    // Allow closing trick modal by clicking backdrop
    trickModalEl.addEventListener('click', (e) => {
      if(e.target === trickModalEl) {
        trickModalEl.classList.remove('show');
        document.querySelectorAll('.fx-overlay,.split-wrap,.confetti,.ghost').forEach(n=>n.remove());
        fakeTerminal.textContent = 'Initializing...';
        scanFileEl.textContent = 'preparing...';
        progressBar.style.width = '0%';
        errorFlash.style.opacity = '0';
      }
    });

    // Treat opens the embedded map in a modal for mobile-friendly viewing
    treatBtn.addEventListener('click', () => {
      treatModal.classList.add('show');
      trapFocus(treatModal);
    });

    document.getElementById('treatClose').addEventListener('click', () => {
      treatModal.classList.remove('show');
    });

    treatModal.addEventListener('click', (e) => {
      if(e.target === treatModal) treatModal.classList.remove('show');
    });
  </script>
</body>
</html>